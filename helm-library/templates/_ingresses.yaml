{{- define "helm-library.ingresses.tpl" -}}
{{ $namespace := .Values.namespace }}
{{ range $ingress := .Values.ingresses }}
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: {{ $ingress.name }}
  namespace: {{ $namespace }}
  annotations:
    kubernetes.io/ingress.global-static-ip-name: {{ $ingress.ip }}
    external-dns.alpha.kubernetes.io/hostname: example.com
    external-dns.alpha.kubernetes.io/cloudflare-proxied: "true"
spec:
  {{- if $ingress.tls }}
  tls:
    - secretName: {{ $ingress.tls.secret }}
      hosts:
        - {{ $ingress.tls.host }}
  {{- end }}
  rules:
    {{ toYaml $ingress.rules | nindent 4 }}
{{- end -}}
{{- end -}}